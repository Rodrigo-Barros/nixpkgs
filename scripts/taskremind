#!/bin/bash
taskwarrior="task add "
remind="REM "
#task="corrigir +bug em @blueweb &21 14:00+10 +1w"
#task="corrigir +bug em @blueweb &21 14:00+10 08-07-22+1d"
task="arrumar problema de transferencia de ligações +bug +frontend +backend @blueweb 14:00+15 08-07-22+1d"

#printf "Informe os detalhes da tarefa:"
#read task

check_regex(){
  word=$1
	pattern=$2
  echo $word | grep -E "$pattern"
}

replace(){
 string=$1
 search_string=$2
 replace_by=$3
 echo $string | sed "s/$search_string/$replace_by/"
}

for word in $(seq 1 $(echo $task | wc -w) ); do
  current_word=$( echo $task |  cut -d " " -f$word )
	# Palavra normal
   if [ $(check_regex "$current_word" "^[a-zA-Z]") ];then
	   taskwarrior+="$current_word "
		 remind+="$current_word "
	 
	 # Assunto/Categoria
   elif [ $(check_regex "$current_word" "^\+[a-zA-Z]") ];then
	   taskwarrior+="$current_word "
	 	 current_word=$(replace "$current_word" "+" "")
		 #remind+="$current_word "

   # Projeto
   elif [ $(check_regex "$current_word" "^@") ];then
	 	 current_word=$(replace "$current_word" "@" "")
	   taskwarrior+="project:$current_word "
		 remind+="$current_word "

	 # Depends
   elif [ $(check_regex "$current_word" "^&") ];then
		current_word=$(replace "$current_word" "&" "")
		taskwarrior+="depends:$current_word "

	 # Hora
	 elif [ $(check_regex "$current_word" "^[0-9]{2}:[0-9]{2}") ];then
	  hour=$(echo $current_word | sed -r "s/^([0-9]{2}:[0-9]{2}).+/\1/")
		notification_before_time=$(echo $current_word | sed -r "s/.+(\+[0-9]{1,})$/\1/")
    [ $notification_before_time = $hour ] && \
		  remind+="AT $hour " || \
			remind+="AT $notification_before_time $hour "
   
   # Dias a frente
	 elif [ $(check_regex "$current_word" "^\+[0-9]{1,}d$") ];then
	  days=$(echo $current_word | sed -r "s/(d|\+)//g")
	  #taskwarrior+=$(date -d "+$days days " "%Y-%m-%d")
		taskwarrior+="due:$current_word"
    #remind+="$current_word "

   # Semanas a frente
	 elif [ $(check_regex "$current_word" "^\+[0-9]{1,}w$") ];then
	  weeks=$(echo $current_word | sed -r "s/(w|\+)//g")
	  #taskwarrior=$(date -d "+$weeks weeks ")
		taskwarrior+="due:$current_word"
    #remind+="$current_word "

   # Meses a frente
	 elif [ $(check_regex "$current_word" "^\+[0-9]{1,}m$") ];then
	  weeks=$(echo $current_word | sed -r "s/(m|\+)//g")
	  #taskwarrior+=$(date -d "+$weeks months ")
		taskwarrior+="due:$current_word"
    #remind+="$current_word "

	 # Dia especifico para a tarefa/lembrete
	 #elif [ $(check_regex "$current_word" "^[0-9]{2}-[0-9]{2}-[0-9]{2,4}\+?([0-9a-z]{2})?") ];then
	 elif [ $(check_regex "$current_word" "^[0-9]{2}-[0-9]{2}-[0-9]{2,4}") ];then
		#days_before=$(echo $current_word | sed -r "s/^.+([0-9][a-z]{1})/\1/")
		days_before=$(echo $current_word | sed -r "s/^[0-9]{2}-[0-9]{2}-[0-9]{2,4}\+([0-9])./\+\1/")
	  day=$(echo $current_word | sed -r "s/^([0-9]{2}).+/\1/")
	  month=$(echo $current_word | sed -r "s/.+([0-9]{2})-.+/\1/")
	  #year=$(echo $current_word | sed -r "s/.+-([0-9]{2,4}$)/\1/")
	  year=$(echo $current_word | sed -r "s/.+-([0-9]{2,4})(\+\w{2})?$/\1/")
		
	  taskwarrior+=$(date -d "$year-$month-$day" +"due:%Y-%m-%d")
    remind+="$(LC_ALL=en_US.UTF-8 date -d "$year-$month-$day" +"$days_before %d %b %Y" )"

	fi
done

echo taskwarrior: $taskwarrior
echo remind: $remind
